---
layout: post
title: Assignment - Blog Post 1
---

> This blog post includes 

## ยง1. Database Creation

### Step 1: Data Importing

For the temperature dataset, first do the visualization. The real importing part happens together with the database creation.

```python
import pandas as pd
temperatures = pd.read_csv("/Users/xuyan/Desktop/temps.csv")
temperatures.head()
```

Now, import the stations and the countries dataset

```python
# this is the countries data
countries_url = "https://raw.githubusercontent.com/mysociety/gaze/master/data/fips-10-4-to-iso-country-codes.csv"
countries = pd.read_csv(countries_url)
# countries.head()
```

```python
# this is the stations data
stations_url = "https://raw.githubusercontent.com/PhilChodrow/PIC16B/master/datasets/noaa-ghcn/station-metadata.csv"
stations = pd.read_csv(stations_url)
# stations.head()
```

### Step 2: Database Settling

First, create the database:

```python
import sqlite3
conn = sqlite3.connect("temps.db")
# store the path for temperature csv file
temps = "/Users/xuyan/Desktop/temps.csv"
df_iter = pd.read_csv(temps, chunksize = 100000)
df = df_iter.__next__()
```

Now, reshape the dataset to store as the temperature dataset

```python
# reshape function:
def prepare_df(df):
    df = df.set_index(keys=["ID", "Year"])
    df = df.stack()
    df = df.reset_index()
    df = df.rename(columns = {"level_2"  : "Month" , 0 : "Temp"})
    df["Month"] = df["Month"].str[5:].astype(int)
    df["Temp"]  = df["Temp"] / 100
    return(df)

# reshaping process:
df = prepare_df(df)
df.head()
```

Now, write the three datasets to the database:

```python
# 1. write temperature dataset to database
df_iter = pd.read_csv(temps, chunksize = 100000)
for df in df_iter:
    df = prepare_df(df)
    df.to_sql("temperatures", conn, if_exists = "append", index = False)

# 2. write stations dataset to database
stations.to_sql("stations", conn, if_exists = "replace", index = False)

# 3. write countries dataset to database
countries.to_sql("countries", conn, if_exists = "replace", index = False)
```

### Step 3: Database Precheck

Now, visualize the general information of the dataset:

- Datasets in Database

```python
cursor = conn.cursor()
cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
print(cursor.fetchall())
```
`[('temperatures',), ('stations',), ('countries',)]`


- Datasets Contents in Database

```python
cursor.execute("SELECT sql FROM sqlite_master WHERE type='table';")

for result in cursor.fetchall():
    print(result[0])
```
`CREATE TABLE "temperatures" (
"ID" TEXT,
  "Year" INTEGER,
  "Month" INTEGER,
  "Temp" REAL
)
CREATE TABLE "stations" (
"ID" TEXT,
  "LATITUDE" REAL,
  "LONGITUDE" REAL,
  "STNELEV" REAL,
  "NAME" TEXT
)
CREATE TABLE "countries" (
"FIPS 10-4" TEXT,
  "ISO 3166" TEXT,
  "Name" TEXT
)`

Last, close the database for writing on.

```python
conn.close()
```

## ยง2. Query Function

> This Query function `query_climate_database()` inputs specified country name, start year and end year for consideration, specified month to look on, and return a dataset to write on. 

```python

```

## ยง3. Geographical Scatter Function



## ยง4. More Figures



This is the end of this blog post! :)

{::options parse_block_html="true" /}
<div class="got-help">
I learned something really cool from my peer feedback! 
</div>
{::options parse_block_html="false" /}

{::options parse_block_html="true" /}
<div class="gave-help">
I gave one of my peers a cool suggestion! 
</div>
{::options parse_block_html="false" /}

